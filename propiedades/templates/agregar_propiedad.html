{% extends 'base.html' %}

{% block content %}

<br>
<br>
<br>
<br>
<br>
<br>

<div class="container">
    <div class="row justify-content-center">
        <div class="card p-4">
            <h3 class="card-title text-center mb-4">Agregar Propiedad</h3>
            <form method="POST">
                {% csrf_token %}
                {% if form.errors %}
                    <div class="alert alert-danger" role="alert">
                        Por favor, corrige los siguientes errores:
                        <ul>
                            {% for field, errors in form.errors.items %}
                                {% for error in errors %}
                                    <li>{{ error }}</li>
                                {% endfor %}
                            {% endfor %}
                        </ul>
                    </div>
                {% endif %}

                <div class="mb-3">
                    {{ form.region.label_tag }}
                    {{ form.region }}
                    {% if form.region.errors %}
                        {% for error in form.region.errors %}
                            <div class="text-danger">{{ error }}</div>
                        {% endfor %}
                    {% endif %}
                </div>

                <div class="mb-3">
                    {{ form.comuna.label_tag }}
                    <select name="comuna" id="id_comuna" class="form-select">
                        <option value="">Seleccione una comuna</option>
                    </select>
                    {% if form.comuna.errors %}
                        {% for error in form.comuna.errors %}
                            <div class="text-danger">{{ error }}</div>
                        {% endfor %}
                    {% endif %}
                </div>

                <div class="mb-3">
                    {{ form.direccion_calle.label_tag }}
                    {{ form.direccion_calle }}
                    {% if form.direccion_calle.errors %}
                        {% for error in form.direccion_calle.errors %}
                            <div class="text-danger">{{ error }}</div>
                        {% endfor %}
                    {% endif %}
                </div>

                <div class="mb-3">
                    {{ form.direccion_numero.label_tag }}
                    {{ form.direccion_numero }}
                    {% if form.direccion_numero.errors %}
                        {% for error in form.direccion_numero.errors %}
                            <div class="text-danger">{{ error }}</div>
                        {% endfor %}
                    {% endif %}
                </div>
                <div class="mb-3">
                    {{ form.tipo.label_tag }}
                    {{ form.tipo }}
                    {% if form.tipo.errors %}
                        {% for error in form.tipo.errors %}
                            <div class="text-danger">{{ error }}</div>
                        {% endfor %}
                    {% endif %}
                </div>

                <div class="mb-3">
                    {{ form.estado.label_tag }}
                    {{ form.estado }}
                    {% if form.estado.errors %}
                        {% for error in form.estado.errors %}
                            <div class="text-danger">{{ error }}</div>
                        {% endfor %}
                    {% endif %}
                </div>

                <div class="mb-3">
                    {{ form.area.label_tag }}
                    {{ form.area }}
                    {% if form.area.errors %}
                        {% for error in form.area.errors %}
                            <div class="text-danger">{{ error }}</div>
                        {% endfor %}
                    {% endif %}
                </div>

                <div class="mb-3">
                    {{ form.habitaciones.label_tag }}
                    {{ form.habitaciones }}
                    {% if form.habitaciones.errors %}
                        {% for error in form.habitaciones.errors %}
                            <div class="text-danger">{{ error }}</div>
                        {% endfor %}
                    {% endif %}
                </div>

                <div class="mb-3">
                    {{ form.ba単os.label_tag }}
                    {{ form.ba単os }}
                    {% if form.ba単os.errors %}
                        {% for error in form.ba単os.errors %}
                            <div class="text-danger">{{ error }}</div>
                        {% endfor %}
                    {% endif %}
                </div>

                <div class="mb-3">
                    {{ form.estacionamiento.label_tag }}
                    {{ form.estacionamiento }}
                    {% if form.estacionamiento.errors %}
                        {% for error in form.estacionamiento.errors %}
                            <div class="text-danger">{{ error }}</div>
                        {% endfor %}
                    {% endif %}
                </div>

                <div class="mb-3">
                    {{ form.precio.label_tag }}
                    {{ form.precio }}
                    {% if form.precio.errors %}
                        {% for error in form.precio.errors %}
                            <div class="text-danger">{{ error }}</div>
                        {% endfor %}
                    {% endif %}
                </div>
                <div class="mb-3">
                    <label for="id_imagen" class="form-label">Imagen de la Propiedad</label>
                    {{ form.imagen }}
                    {% if form.imagen.errors %}
                        {% for error in form.imagen.errors %}
                            <div class="text-danger">{{ error }}</div>
                        {% endfor %}
                    {% endif %}
                </div>

                <div class="text-center">
                    <button type="submit" class="btn btn-primary btn-lg">Guardar Propiedad</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    document.getElementById('id_region').addEventListener('change', function() {
        var regionId = this.value;
        fetch(`/api/comunas/${regionId}/`)  
            .then(response => response.json())
            .then(data => {
                var comunaSelect = document.getElementById('id_comuna');
                comunaSelect.innerHTML = '<option value="">Seleccione una comuna</option>';
                data.comunas.forEach(comuna => {
                    var option = document.createElement('option');
                    option.value = comuna.id;
                    option.textContent = comuna.nombre;
                    comunaSelect.appendChild(option);
                });
            });
    });
</script>

{% endblock %}
